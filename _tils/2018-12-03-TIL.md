---
layout: post
title: 2018-12-03 TIL
description: "TIL"
tags: [TIL, 강의노트]
---

## 방통대 강의노트 (UNIX 시스템, 데이터베이스 설계 및 구현)

### UNIX 시스템(웹 서버)

#### APM (Apache, PHP, MySQL)

- 대부분의 리눅스 배포판이 포함
- 설치확인

```bash
$ yum list installed | grep httpd / mysql / php
```

#### Apache

- 전역설정
  - `/etc/httpd/conf/httpd.conf`
  - `/etc/httpd/conf.d/`: 기타 설정파일
- 현재 런레벨에서 서비스 활성화

  - `chkconfig httpd on`

- 지시어
  - 설정파일(`httpd.conf`)에서 사용됨
  - 지시어의 종류는 다양함
  - ServerRoot
    - Apache 서버가 설치된 디렉터리
    - 설정파일에서 파일을 참조할때의 기준
    - 기본값은 `/etc/httpd`
  - Timeout
    - 클라이언트로부터 수신을 기다리는 최대 대기시간 (기본값: 60초)
  - PidFile
    - 주 서버프로세스로 httpd의 PID가 기록되는 파일을 설정
  - MaxKeepAliveRequests
    - KeepAlive 설정시 지속적인 연결로 보낼 수 있는 최대 요청의 수
    - 기본값은 100, 0이면 제한없이 요청을 받음
  - KeepAliveTimeout
    - 연결을 끊지 않고 다음 요청을 대기하는 최대 시간
    - 과도하게 큰 값으로 설정시 서버설정에 문제가 생길 수 있음
  - StartServers
    - 초기에 생성하는 자식 서버 프로세스의 수
  - LoadModule
    - 웹 서버의 기능을 확장시키는 모듈설정
    - `LoadModule 모듈이름 모듈파일`

### 데이터베이스 설계 및 구현(트랜잭션과 백업)

#### 트랜잭션과 잠금

- 트랜잭션

  > 서로 연관된 다수의 데이터베이스 명령들로 이루어진 논리적 작업단위

  - 데이터에 대한 동시에 발생한 작업요청시 일관성 및 무결성 훼손 문제가 발생하지 않도록 데이터 연산을 단위로 묶어 처리하기 위한 개념

- 트랜잭션 명령어

  - `START`
    - 새로운 트랜잭션을 시작
  - `COMMIT`
    - 트랜잭션에서 변경한 항목을 영구적으로 시스템에 반영
  - `SAVEPOINT id`
    - 저장 시점 id를 지정
  - `ROLLBACK [id]`
    - 트랜잭션의 변경내역을 모두 복귀하거나 id 저장시점으로 복귀

- 자동커밋 트랜잭션

  - MYSQL 에서는 기본적으로 모든 실행되는 질의는 실행후 사용자의 요청없이 자동커밋
  - 비활성화하려면 `SET autocommit=0`

- 형식

```sql
START TRANSACTION
   [WITH CONSISTANT SNAPSHOT]
   [READ WRITE]
   [READ ONLY]
     SQL...
COMMIT 혹은 ROLLBACK
```

- 프로시저의 HANDLER, BEGIN~END 사이에서 처리가능

- 잠금

  > 트랜잭션 간 테이블 접근순서를 지정

  - 한 트랜잭션이 다른 트랜잭션에서 사용중인 테이블에 대한 접근을 방지
  - 트랜잭션이 끝나면 `UNLOCK`을 사용

- 잠금의 종류
  - `READ LOCK`
    - 다른 읽기가능, 쓰기불가
    - 복수 세션에 의해 취득가능
    - `LOCK TABLES 테이블명 READ`
  - `WRITE LOCK`
    - 다른 읽기/쓰기 불가
    - 단일 세션에 의해서만 취득가능
    - `LOCK TABLES 테이블명 WRITE`

#### 백업과 복원

- 백업

  > 데이터와 트랜잭션에 수행되는 변경내용과 로그를 주기적으로 별도로 저장하는 작업

  - 방식별 구분
    - 물리적 백업
      - DBMS 가 사용하는 데이터 원본파일을 직접복사하여 백업
      - 데이터파일 (_.FRM, _.MYD, \*.MYI)을 백업
    - 논리적 백업
      - 원본 데이터베이스와 동등한 데이터베이스를 구축하기 위한 DML을 추출
      - 논리적백업을 위한 소프트웨어인 mysqldump를 사용
  - 상태별 구분
    - 온라인 백업/핫백업
      - DBMS가 운용되고 있는 상태에서 데이터백업을 진행하는 방식
    - 오프라인 백업/콜드백업
      - DBMS를 정지시킨 상태에서 데이터백업을 진행하는 방식
  - 대상별 구분
    - 전체백업
    - 증분백업
      - 전체백업 이후 주어진 시간 동안 이루어진 변경된 데이터만을 백업
  - 장소별 구분
    - 로컬백업
    - 원격백업
      - 백업을 수행하는 컴퓨터가아닌 원격으로 연결된 DBMS를 백업하는 방식

- 복원
  > 저장된 백업데이터를 사용하여 특정 시점으로 데이터베이스를 복구하는 작업
  - 물리적 데이터를 통한 복원
    - 복제된 데이터파일을 datadir변수에서 명시한 디렉토리에 복사
  - 논리적 데이터를 통한 복원
    - mysql 클라이언트 유틸리티를 사용
    - `mysql -u 사용자명 -p 데이터베이스 이름 < 파일이름`
